@model IEnumerable<rainbow.Domain.Client.Cliente>

<style>
    input[type="search"]::-webkit-search-cancel-button {
        /*Bootstrap 3 override*/
        -webkit-appearance: searchfield-cancel-button !important;
    }

    .ResumoClientes {
        clear: both;
        border: 1px solid lightgray;
        max-height: 120px;
        border-radius: 5px;
        margin-bottom: 1em;
    }

    .RowHeader th {
        text-align: center;
    }

    .Indicadores td {
        text-align: center;
        vertical-align: inherit !important;
    }

    .caixaProcura {
        float: right;
        margin-bottom: 1em;
    }

    .botaoCriar {
        float: left !important;
        margin-bottom: 0 !important;
        margin-right:1em;
    }


    .enableToggle{
        float:right;
    } 
    
    .bootstrap-table .table {
        margin-bottom: 0 !important;
        border-bottom: 1px solid #dddddd;
        border-collapse: collapse !important;
        border-radius: 1px;
    }

        .bootstrap-table .table, .bootstrap-table .table > tbody > tr > th, .bootstrap-table .table > tfoot > tr > th, .bootstrap-table .table > thead > tr > td, .bootstrap-table .table > tbody > tr > td, .bootstrap-table .table > tfoot > tr > td {
            padding: 8px !important;
        }

            .bootstrap-table .table.table-no-bordered > thead > tr > th, .bootstrap-table .table.table-no-bordered > tbody > tr > td {
                border-right: 2px solid transparent;
            }

    .fixed-table-container {
        position: relative;
        clear: both;
        border: 1px solid #dddddd;
        border-radius: 4px;
        -webkit-border-radius: 4px;
        -moz-border-radius: 4px;
    }

        .fixed-table-container.table-no-bordered {
            border: 1px solid transparent;
        }

    .fixed-table-footer, .fixed-table-header {
        overflow: hidden;
    }

    .fixed-table-footer {
        border-top: 1px solid #dddddd;
    }

    .fixed-table-body {
        overflow-x: auto;
        overflow-y: auto;
        height: 100%;
    }

    .fixed-table-container table {
        width: 100%;
    }

    .fixed-table-container thead th {
        height: 0;
        padding: 0;
        margin: 0;
        border-left: 1px solid #dddddd;
    }

        .fixed-table-container thead th:first-child {
            border-left: none;
            border-top-left-radius: 4px;
            -webkit-border-top-left-radius: 4px;
            -moz-border-radius-topleft: 4px;
        }

        .fixed-table-container thead th .th-inner, .fixed-table-container tbody td .th-inner {
            padding: 8px;
            line-height: 24px;
            vertical-align: top;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .fixed-table-container thead th .sortable {
            cursor: pointer;
            background-position: right;
            background-repeat: no-repeat;
            padding-right: 30px;
        }

        .fixed-table-container thead th .both {
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAQAAADYWf5HAAAAkElEQVQoz7X QMQ5AQBCF4dWQSJxC5wwax1Cq1e7BAdxD5SL+Tq/QCM1oNiJidwox0355mXnG/DrEtIQ6azioNZQxI0ykPhTQIwhCR+BmBYtlK7kLJYwWCcJA9M4qdrZrd8pPjZWPtOqdRQy320YSV17OatFC4euts6z39GYMKRPCTKY9UnPQ6P+GtMRfGtPnBCiqhAeJPmkqAAAAAElFTkSuQmCC');
        }

        .fixed-table-container thead th .asc {
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAZ0lEQVQ4y2NgGLKgquEuFxBPAGI2ahhWCsS/gDibUoO0gPgxEP8H4ttArEyuQYxAPBdqEAxPBImTY5gjEL9DM+wTENuQahAvEO9DMwiGdwAxOymGJQLxTyD+jgWDxCMZRsEoGAVoAADeemwtPcZI2wAAAABJRU5ErkJggg==');
        }

        .fixed-table-container thead th .desc {
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAZUlEQVQ4y2NgGAWjYBSggaqGu5FA/BOIv2PBIPFEUgxjB+IdQPwfC94HxLykus4GiD+hGfQOiB3J8SojEE9EM2wuSJzcsFMG4ttQgx4DsRalkZENxL+AuJQaMcsGxBOAmGvopk8AVz1sLZgg0bsAAAAASUVORK5CYII= ');
        }

    .fixed-table-container th.detail {
        width: 30px;
    }

    .fixed-table-container tbody td {
        border-left: 1px solid #dddddd;
    }

    .fixed-table-container tbody tr:first-child td {
        border-top: none;
    }

    .fixed-table-container tbody td:first-child {
        border-left: none;
    }
    /* the same color with .active */
    .fixed-table-container tbody .selected td {
        background-color: #f5f5f5;
    }

    .fixed-table-container .bs-checkbox {
        text-align: center;
    }

        .fixed-table-container .bs-checkbox .th-inner {
            padding: 8px 0;
        }

    .fixed-table-container input[type="radio"], .fixed-table-container input[type="checkbox"] {
        margin: 0 auto !important;
    }

    .fixed-table-container .no-records-found {
        text-align: center;
    }

    .fixed-table-pagination div.pagination, .fixed-table-pagination .pagination-detail {
        margin-top: 10px;
        margin-bottom: 10px;
    }

        .fixed-table-pagination div.pagination .pagination {
            margin: 0;
        }

    .fixed-table-pagination .pagination a {
        padding: 6px 12px;
        line-height: 1.428571429;
    }

    .fixed-table-pagination .pagination-info {
        line-height: 34px;
        margin-right: 5px;
    }

    .fixed-table-pagination .btn-group {
        position: relative;
        display: inline-block;
        vertical-align: middle;
    }

    .fixed-table-pagination .dropup .dropdown-menu {
        margin-bottom: 0;
    }

    .fixed-table-pagination .page-list {
        display: inline-block;
    }

    .fixed-table-toolbar .columns-left {
        margin-right: 5px;
    }

    .fixed-table-toolbar .columns-right {
        margin-left: 5px;
    }

    .fixed-table-toolbar .columns label {
        display: block;
        padding: 3px 20px;
        clear: both;
        font-weight: normal;
        line-height: 1.428571429;
    }

    .fixed-table-toolbar .bars, .fixed-table-toolbar .search, .fixed-table-toolbar .columns {
        position: relative;
        margin-top: 10px;
        margin-bottom: 10px;
        line-height: 34px;
    }

    .fixed-table-pagination li.disabled a {
        pointer-events: none;
        cursor: default;
    }

    .fixed-table-loading {
        display: none;
        position: absolute;
        top: 42px;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: 99;
        background-color: #fff;
        text-align: center;
    }

    .fixed-table-body .card-view .title {
        font-weight: bold;
        display: inline-block;
        min-width: 30%;
        text-align: left !important;
    }
    /* support bootstrap 2 */
    .fixed-table-body thead th .th-inner {
        box-sizing: border-box;
    }

    .table th, .table td {
        vertical-align: middle;
        box-sizing: border-box;
    }

    .fixed-table-toolbar .dropdown-menu {
        text-align: left;
        max-height: 300px;
        overflow: auto;
    }

    .fixed-table-toolbar .btn-group > .btn-group {
        display: inline-block;
        margin-left: -1px !important;
    }

        .fixed-table-toolbar .btn-group > .btn-group > .btn {
            border-radius: 0;
        }

        .fixed-table-toolbar .btn-group > .btn-group:first-child > .btn {
            border-top-left-radius: 4px;
            border-bottom-left-radius: 4px;
        }

        .fixed-table-toolbar .btn-group > .btn-group:last-child > .btn {
            border-top-right-radius: 4px;
            border-bottom-right-radius: 4px;
        }

    .bootstrap-table .table > thead > tr > th {
        vertical-align: bottom;
        border-bottom: 1px solid #ddd;
    }
    /* support bootstrap 3 */
    .bootstrap-table .table thead > tr > th {
        padding: 0;
        margin: 0;
    }

    .bootstrap-table .fixed-table-footer tbody > tr > td {
        padding: 0 !important;
    }

    .bootstrap-table .fixed-table-footer .table {
        border-bottom: none;
        border-radius: 0;
    }

    .pull-right .dropdown-menu {
        right: 0;
        left: auto;
    }
    /* calculate scrollbar width */
    p.fixed-table-scroll-inner {
        width: 100%;
        height: 200px;
    }

    div.fixed-table-scroll-outer {
        top: 0;
        left: 0;
        visibility: hidden;
        width: 200px;
        height: 150px;
        overflow: hidden;
    }
</style>

@{
    ViewBag.Title = "Index";
}

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">

<br />



@using (Html.BeginForm("Index", "Clientes", FormMethod.Get))
{
    @*@Html.TextBox("search", ViewBag.CurrentFilter as string,
        new { @class = "form-control caixaProcura", placeholder = "Procurar nome ou telemóvel", @type = "search" })*@


<div class="col-lg-12">
    @Html.ActionLink(" ", "Create", new { }, new { @class = "btn btn-primary botaoCriar fa fa-user-plus fa-2x" })

    @Html.CheckBox("status", true, new { id = "change", data_toggle = "toggle", data_on = "Cliente ativo", data_off = "Cliente inativo", type = "checkbox", onclick = "onclick()" })

    <input class="form-control caixaProcura" id="myInput" type="text" placeholder="Procurar..">
</div>

}



<div class="ResumoClientes col-lg-12 col-md-12 col-sm-12 container">
    <table class="table">
        <thead>
            <tr class="RowHeader">
                <th style="color:blue;">
                    Total
                </th>

                <th>
                    Recrutados
                </th>

                <th>
                    Casados
                </th>

                <th>
                    Un. Facto
                </th>

                <th>
                    Divorc.
                </th>

                <th>
                    Cliente RB
                </th>

                <th>
                    Idades
                </th>
            </tr>


        </thead>

        <tbody>
            <tr class="Indicadores table-primary">
                <td title="Número de clientes">
                    <p>@Model.Count()</p>
                </td>

                <td title="Número de clientes recrutados">
                    @{
                        int Recruted = 0;

                        foreach (var item in Model)
                        {
                            if (item.Recrutamento.Count() > 0)
                            {
                                Recruted++;
                            }
                        }

                        <p>@Recruted</p>
                    }
                </td>

                <td>
                    @{
                        int Casados = 0;

                        foreach (var item in Model)
                        {
                            if (item.EstadoCivilId == 1)
                            {
                                Casados++;
                            }
                        }

                        <p>@Casados</p>
                    }
                </td>

                <td>
                    @{
                        int UniaoFacto = 0;

                        foreach (var item in Model)
                        {
                            if (item.EstadoCivilId == 3)
                            {
                                UniaoFacto++;
                            }
                        }

                        <p>@UniaoFacto</p>
                    }
                </td>

                <td>
                    @{
                        int Divorciado = 0;

                        foreach (var item in Model)
                        {
                            if (item.EstadoCivilId == 2)
                            {
                                Divorciado++;
                            }
                        }

                        <p>@Divorciado</p>
                    }
                </td>

                <td>
                    @{
                        int ClientesRb = 0;

                        foreach (var item in Model)
                        {
                            if (item.ClienteRainbow)
                            {
                                ClientesRb++;
                            }
                        }

                        <p>@ClientesRb</p>
                    }
                </td>

                <td>
                    @{
                        int Ate25 = 0;
                        int VinteCintoACinquenta = 0;
                        int AcimaCinquenta = 0;

                        foreach (var item in Model)
                        {
                            if (Convert.ToInt32(item.IdadeCliente) <= 25)
                            {
                                Ate25++;
                            }
                            if (Convert.ToInt32(item.IdadeCliente) > 25 && Convert.ToInt32(item.IdadeCliente) <= 50)
                            {
                                VinteCintoACinquenta++;
                            }
                            if (Convert.ToInt32(item.IdadeCliente) > 50)
                            {
                                AcimaCinquenta++;
                            }
                        }

                        <p>
                            @Ate25<br />
                            @VinteCintoACinquenta<br />
                            @AcimaCinquenta
                        </p>


                    }
                </td>

                <td>
                    <p style="text-align:left;color:darkgray;">
                        ~25<br />
                        25~50<br />
                        50+
                    </p>
                </td>
            </tr>
        </tbody>
    </table>


</div>

<table ref="mainTable" class="display table col-lg-12 col-md-12 col-sm-12 sortable table-condensed table-striped table-hover" cellSpacing="0" id="mainTable" data-show-toggle="true"
       data-show-columns="true" data-search="true" data-pagination="true" data-filter-control="true">

    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.NomeCliente)
            </th>

            <th>
                @Html.DisplayNameFor(model => model.TelemovelCliente)
            </th>
            <th style="text-align:center;">
                @Html.DisplayNameFor(model => model.IdadeCliente)
            </th>

            <th style="text-align:center;">
                @Html.DisplayNameFor(model => model.ElegivelParaRecrutamento)
            </th>

            <th style="text-align:center;">
                Número de ok's
            </th>

            <th style="text-align:center;" data-filter="state">
                Estado
            </th>

            <th></th>

            <th></th>
        </tr>

    </thead>


    @foreach (var item in Model)
    {
        <tbody id="myTable">
            <tr>

                <td id="nome">

                    @Html.DisplayFor(modelItem => item.NomeCliente)

                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.TelemovelCliente)
                </td>
                <td style="text-align:center;">
                    @Html.DisplayFor(modelItem => item.IdadeCliente)
                </td>

                <td style="text-align:center;">
                    @if (item.ElegivelParaRecrutamento)
                    {
                        <img title="Eligível para recrutar" style="width:25px;" src="~/Content/Images/green-light.png" />
                    }
                    else
                    {
                        <img title="Não Eligível para recrutar" style="width:25px;" src="~/Content/Images/red-light.png" />
                    }
                </td>

                <td>
                    @{

                        int numeroOks = 0;


                        foreach (var recomendacao in item.Recomendacao)
                        {
                            if (recomendacao.OkParaContactar)
                            {
                                numeroOks++;
                            }
                        }

                        if (numeroOks > 0)
                        {
                            <p class="popupimage" style="text-align:center;">@numeroOks</p>


                        }
                        else
                        {
                            <p style="text-align:center;color:red;">Sem Ok's</p>
                        }
                    }
                </td>

                <td style="text-align:center;">
                    @*@if ((Convert.ToInt32(item.IdadeCliente) >= 30) && (Convert.ToInt32(item.IdadeCliente) <= 76))
                        {
                            if (item.EstadoCivil.NomeEstadoCivil != "Solteiro(a)")
                            {
                                <img style="float:right; width:50px;" src="~/Content/Images/Qualified.png" />
                            }

                        }*@

                    @{

                        foreach (var demo in item.Demonstracao)
                        {
                            bool fechoManual = false;
                            int recomendacoesOk = 0;
                            int recomendacoesComDemosTerminadas = 0;


                            foreach (var recomendacao in item.Recomendacao)
                            {
                                if (demo.DemoUniqueId == recomendacao.DemonstracaoGuid)
                                {
                                    if (demo.DemoStatus)
                                    {
                                        fechoManual = true;
                                    }

                                    if (recomendacao.OkParaContactar)
                                    {
                                        recomendacoesOk++;
                                    }

                                    if (recomendacao.OkParaContactar && recomendacao.DemoExecutada)
                                    {
                                        recomendacoesComDemosTerminadas++;
                                    }

                                }

                            }

                            if (recomendacoesOk == recomendacoesComDemosTerminadas && recomendacoesOk > 0 || fechoManual)
                            {
                                <img style="width:25px;" title="Cliente com demos fechadas" src="~/Content/Images/finished_flag.png" />

                            }
                            else
                            {
                                <img style="width:25px;" title="Cliente com demos abertas" src="~/Content/Images/unfinished_flag.png" />
                            }

                        }
                    }
                </td>

                <td>
                    @{
                        foreach (var demo in item.Demonstracao)
                        {
                            if (demo.ClienteComprou)
                            {
                                <img src="~/Content/Images/rainbow-image.png" width="20px;" />
                            }
                        }
                    }
                </td>

                @*<td>
                        <a class="btn btn-default" data-toggle="modal" data-target=".bootstrapmodal" ><span class="fa fa-info"></span></a>
                    </td>*@

                <td style="text-align:center; width:10px;">
                    @*@Html.ActionLink("Edit", "Edit", new { id = item.ClientId }) |
                        @Html.ActionLink("Details", "Details", new { id = item.ClientId }) |
                        @Html.ActionLink("Delete", "Delete", new { id = item.ClientId })*@
                    <a href="@Url.Action("Edit", "Clientes", new { id=item.ClientId })" title="Editar @item.NomeCliente">
                        <img src="~/Content/Images/btn_edit.png" width="30" />
                    </a>

                </td>

                <td style="text-align:center; width:10px;">
                    <a href="@Url.Action("Details", "Clientes", new { id=item.ClientId })" title="Detalhes de @item.NomeCliente">
                        <img src="~/Content/Images/btn_details.png" width="30" />
                    </a>
                </td>

                <td style="text-align:center;width:10px;">
                    <a href="@Url.Action("Delete", "Clientes", new { id=item.ClientId })" title="Apagar @item.NomeCliente">
                        <img src="~/Content/Images/btn_delete.png" width="30" />
                    </a>
                </td>

            </tr>
        </tbody>

    }

</table>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="~/Scripts/jquery-1.10.2.js"></script>

    <script>
        $(document).ready(function () {
            $("#myInput").on("keyup", function () {
                var value = $(this).val().toLowerCase();
                $("#myTable tr").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });
        });
    </script>

    @*<script type="text/javascript" charset="utf-8">
        $(document).ready(function () {
            $('#example').dataTable({
                "bServerSide": true,
                "sAjaxSource": "/Home/DataProviderAction"
            });
        });
    </script>*@

    <script>

        $(document).ready(function () {

            // Connect to 'change' event in order to toggle glyphs

            $("[type='checkbox']").change(function () {

                if ($(this).prop('checked')) {

                    $(this).prev().addClass('glyphicon-ok-circle');

                    $(this).prev().removeClass('glyphicon-unchecked');
                    
                }

                else {

                    $(this).prev().removeClass('glyphicon-ok-circle');

                    $(this).prev().addClass('glyphicon-unchecked');

                }

            });

        });

    </script>
}